<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin — Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="container">
    <h2>Dashboard Administrateur</h2>
    <div id="status"></div>

    <section>
      <h3>Créer Produit</h3>
      <form id="formProduit">
        <label>Nom<input id="p_nom"></label>
        <label>Catégorie<input id="p_categorie"></label>
        <label>Unité<input id="p_unite"></label>
        <button type="submit">Créer</button>
      </form>
    </section>

    <section>
      <h3>Créer Marché</h3>
      <form id="formMarche">
        <label>Nom<input id="m_nom"></label>
        <label>Commune<input id="m_commune"></label>
        <label>Localisation<input id="m_loc"></label>
        <button type="submit">Créer</button>
      </form>
    </section>

    <section>
      <h3>Créer Prix</h3>
      <form id="formPrix">
        <label>Produit ID<input id="pr_produit" type="number"></label>
        <label>Marché ID<input id="pr_marche" type="number"></label>
        <label>Prix<input id="pr_prix" type="number" step="0.01"></label>
        <label>Date<input id="pr_date" type="date"></label>
        <button type="submit">Créer</button>
      </form>
    </section>

  </main>

  <script>
    function authHeaders(){
      const t = localStorage.getItem('token');
      return t? {'Content-Type':'application/json','Authorization':'Bearer '+t} : {'Content-Type':'application/json'};
    }

    async function post(url, body){
      const r = await fetch(url, {method:'POST', headers: authHeaders(), body: JSON.stringify(body)});
      return r;
    }

    async function showStatus(msg){ document.getElementById('status').textContent = msg; }

    document.getElementById('formProduit').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const body = {nom: document.getElementById('p_nom').value, categorie: document.getElementById('p_categorie').value, unite: document.getElementById('p_unite').value};
      const r = await post('/api/admin/produits', body);
      showStatus(r.ok? 'Produit créé' : 'Erreur: '+(await r.text()));
    });

    document.getElementById('formMarche').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const body = {nom: document.getElementById('m_nom').value, commune: document.getElementById('m_commune').value, localisation: document.getElementById('m_loc').value};
      const r = await post('/api/admin/marches', body);
      showStatus(r.ok? 'Marché créé' : 'Erreur: '+(await r.text()));
    });

    document.getElementById('formPrix').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const body = {produit: {id: Number(document.getElementById('pr_produit').value)}, marche: {id: Number(document.getElementById('pr_marche').value)}, prix: Number(document.getElementById('pr_prix').value), date: document.getElementById('pr_date').value};
      const r = await post('/api/admin/prix', body);
      showStatus(r.ok? 'Prix créé' : 'Erreur: '+(await r.text()));
    });
  </script>
</body>
</html>
